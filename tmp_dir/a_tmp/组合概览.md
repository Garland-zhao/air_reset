## 组合分析

table

组合详情 @zxg

| id   | port id（str) | portname | 组合金额 | 组合数量 | weight |      | 日收益率 | 累计收益率 | date       | ceate_date | 管理人 | sub  |      |      |      |
| ---- | ------------- | -------- | -------- | -------- | ------ | ---- | -------- | ---------- | ---------- | ---------- | ------ | ---- | ---- | ---- | ---- |
|      | 1             |          |          |          |        |      |          |            | 2022-01-01 |            |        |      |      |      |      |
|      | 1             |          |          |          |        |      |          |            | 2022-01-02 |            |        |      |      |      |      |

组合调仓表/ 持仓表  @赵帆

| port_id        |      |      |      |      |      |
| -------------- | ---- | ---- | ---- | ---- | ---- |
| portname       |      |      |      |      |      |
| und_code       |      |      |      |      |      |
| fund_name      |      |      |      |      |      |
| Weight         |      |      |      |      |      |
| 金额           |      |      |      |      |      |
| rebalance_flag |      |      |      |      |      |
| date           |      |      |      |      |      |
|                |      |      |      |      |      |

建仓/调仓 逻辑：

先删除调仓日期的rebalance_flag=1的所有数据，然后再插入新调仓数据并 set  rebalance_flag=1

每日收益率计算逻辑：

先找 rebalance_flag=1，进行计算

如果没有再计算rebalance_flag=0，

计算完之后，set rebalance_flag=0，插入数据



## 接口

1. 组合累计收益接口 @cxd

```python
# date, ret , rebalance_status
data[
  [date1, ret1, 1],
   [date2, ret2, 0],
]
```

2.  单标的累计收益接口 @cxd

```python
# date, ret 
data[
  [date1, ret1],
   [date2, ret2],
]
```

3. 组合详情  @zxg
4. 组合持仓 @赵帆
5. 组合收益贡献 contribution @cxd
6. 组合资产占比 port_asset_weight @cxd
7. 调仓记录 rebalance_records @cxd
8. 组合行业占比 port_indus_weight  @cxd
9. 组合重仓占比：port_hevily_stock_weight  @cxd

## 每日任务

1. 更新组合调仓表/ 持仓表  @赵帆
2. 更新 组合详情  @zxg